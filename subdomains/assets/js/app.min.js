/*! BikePlusApp 2013-08-07 00:05 */
var BikePlus=function(a,b,c){function d(){google.maps.visualRefresh=!0,I.style.height=a.innerHeight+70+"px",v=new google.maps.Map(I,{center:eb.get()?new google.maps.LatLng(eb.get().lat,eb.get().lng):new google.maps.LatLng("40.7266119","-73.9930061"),zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0}),google.maps.event.trigger(v,"resize"),w=new google.maps.Marker({map:v,icon:{url:cb},zIndex:100}),google.maps.event.addListener(v,"dragstart",function(){J.style.top=a.innerHeight-60+"px",J.style.display="block",y=!0,a.scrollTo(0,1)}),google.maps.event.addListener(v,"bounds_changed",function(){"undefined"!=typeof z&&Date.now()-z<100||(z=+Date.now(),j(),w.setZIndex(google.maps.Marker.MAX_ZINDEX+1),eb.set(v.getCenter().lat(),v.getCenter().lng()))}),setTimeout(function(){C=a.innerHeight,I.style.height=C+70+"px",K.style.top=C-60+"px",J.style.top=C-60+"px",M.style.top=C+60+"px"},750),fb.getLocationUpdate()}function e(){for(var a=v.getZoom(),b=v.getBounds(),d=0,e=Docks.stations.length;e>d;d++){var f=new google.maps.LatLng(Docks.stations[d].la,Docks.stations[d].lo);b.contains(f)&&E.push({id:Docks.stations[d].id,ad:Docks.stations[d].ad,ab:Docks.stations[d].ab,sn:Docks.stations[d].sn,la:Docks.stations[d].la,lo:Docks.stations[d].lo,latLng:f})}for(var d=0,e=E.length;e>d;d++)if(id=E[d].id,D[id]=D[id]||{},16>a){var h=15+2*(a-16);void 0===D[id].marker?D[id].marker=new google.maps.Marker({position:E[d].latLng,map:v,icon:{url:db,size:new google.maps.Size(h,h),scaledSize:new google.maps.Size(h,h)},zIndex:1,optimized:!0}):D[id].markerType!=="small"+h&&D[id].marker.setIcon({url:db,size:new google.maps.Size(h,h),scaledSize:new google.maps.Size(h,h)}),D[id].markerType="small"+h,void 0!==D[id].listenerHandler&&(google.maps.event.removeListener(D[id].listenerHandler),D[id].listenerHandler=void 0)}else void 0===D[id].marker?D[id].marker=new google.maps.Marker({position:E[d].latLng,map:v,icon:{url:$?"/assets/img/geolocationmarker_old_android.v2.png":i(E[d].id,E[d].sn,E[d].ab,E[d].ad),size:new google.maps.Size(V,W),scaledSize:new google.maps.Size(V,W)},zIndex:1}):"big"!==D[id].markerType&&D[id].marker.setIcon({url:$?"/assets/img/geolocationmarker_old_android.v2.png":i(E[d].id,E[d].sn,E[d].ab,E[d].ad),size:new google.maps.Size(V,W),scaledSize:new google.maps.Size(V,W)}),D[id].markerType="big",void 0===D[id].listenerHandler&&(D[id].listenerHandler=google.maps.event.addListener(D[id].marker,"click",function(a){return function(){return a===x?(I.style.height=C+20+"px",google.maps.event.trigger(v,"resize"),v.panTo(A),J.style.display="block",y=!0,M.style.top=C+60+"px",x="",void 0):(x=a,gb.is_running()?(E[a].timer="true",E[a].timerlabel=c.lang.mobile_js_ride_finish):(E[a].timer="",E[a].timerlabel=c.lang.mobile_js_ride_start),E[a].facebook=H?"":"notconnected",currentBookmarks=void 0===localStorage.bookmarkDock?[]:r(localStorage.bookmarkDock),E[a].bookmarksAdded=currentBookmarks.filter(function(b){return b.id===E[a].id?!0:!1})[0],A=v.getCenter(),E[a].distance=g(F,G,E[a].la,E[a].lo),M.innerHTML=X.dock(E[a]),M.style.top=C-100-48+"px",I.style.height=C-100-48+20+"px",google.maps.event.trigger(v,"resize"),v.panTo(E[a].latLng),y=!0,void 0)}}(d)))}function f(a){a.preventDefault(),a.stopPropagation();for(var b=a.target;b;){if("close"===b.className){I.style.height=C+20+"px",google.maps.event.trigger(v,"resize"),v.panTo(A),J.style.display="block",y=!0,M.style.top=C+60+"px";break}if(b.className.indexOf("timing")>-1){var d=Docks.stations.filter(function(a){return a.id===b.dataset.dockid?!0:!1})[0];if("true"===b.value){gb.stop({dock:{id:d.id,sn:d.sn,la:d.la,lo:d.lo}}),b.className="timing",b.querySelector("strong").innerHTML=c.lang.mobile_js_ride_start,b.value="";break}var e=b.querySelector(".sharefacebook").className.indexOf("facebook")>-1?!0:!1,f=b.querySelector(".countdown"),g=b.querySelector("strong");g.innerHTML=c.lang.mobile_js_ride_starting,setTimeout(function(){f.innerHTML="<span>3</span>"},50),setTimeout(function(){f.innerHTML="<span>2</span>"},1250),setTimeout(function(){f.innerHTML="<span>1</span>",gb.start({fbshare:e,dock:{id:d.id,sn:d.sn,la:d.la,lo:d.lo}})},2500),setTimeout(function(){b.value="true",b.className="timing active",f.innerHTML='<span class="icon-stopwatch"></span>',g.innerHTML=c.lang.mobile_js_ride_finish},3750),setTimeout(function(){I.style.height=C+20+"px",google.maps.event.trigger(v,"resize"),v.panTo(A),J.style.display="block",y=!0,M.style.top=C+60+"px"},5e3);break}if(b.className.indexOf("sharefacebook")>-1){b.className.indexOf("notconnected")>-1?FB.login(s,{scope:"publish_actions"}):b.classList.toggle("disabled");break}if(b.className.indexOf("setbookmark")>-1){h(b);break}b=b.parentNode}}function g(a,b,d,e){d=Number(d),e=Number(e),a=parseInt(1e8*a,10)/1e8,b=parseInt(1e8*b,10)/1e8,d=parseInt(1e8*d,10)/1e8,e=parseInt(1e8*e,10)/1e8;var f=c.lang.mobile_dockdistanceratio,g=Math.PI/180,h=(d-a)*g,i=(e-b)*g,j=Math.sin(h/2)*Math.sin(h/2)+Math.cos(a*g)*Math.cos(d*g)*Math.sin(i/2)*Math.sin(i/2),k=2*Math.atan2(Math.sqrt(j),Math.sqrt(1-j)),l=f*k;return Math.round(100*l)/100}function h(a){var b=Docks.stations.filter(function(b){return b.id===a.dataset.dockid?!0:!1})[0];void 0===localStorage.bookmarkDock&&(localStorage.bookmarkDock=JSON.stringify([]));var d=r(localStorage.bookmarkDock);0===d.filter(function(b){return b.id===a.dataset.dockid?!0:!1}).length&&d.push({id:b.id,sn:b.sn,la:b.la,lo:b.lo,latLng:b.latLng}),localStorage.bookmarkDock=JSON.stringify(d),a.querySelector("strong").innerHTML=c.lang.mobile_js_bookmarks_added,a.querySelector(".icon-bookmark").classList.add("added"),setTimeout(function(){a.querySelector("strong").innerHTML=""},1750)}function i(a,c,d,e){var f=c+d+e;if(i.cache||(i.cache={}),i.cache[f])return i.cache[f];var g=b.createElement("canvas");return context=g.getContext("2d"),g.width=V*Z,g.height=W*Z,context.drawImage(bb,0,0,g.width,g.height),context.fillStyle="rgba(255,255,255,1)",context.font=10*Z+"px "+_,context.textAlign="left",context.fillText(c,5*Z,37*Z,60*Z),context.fillStyle="rgba(0,0,0,1)",context.font=16*Z+"px "+_,context.textAlign="left",context.fillText(d,20*Z,20*Z),context.fillStyle="rgba(0,0,0,1)",context.font=16*Z+"px "+_,context.textAlign="left",context.fillText(e,51*Z,20*Z),i.cache[f]=g.toDataURL(),i.cache[f]}function j(){return"undefined"!=typeof a.Docks&&Date.now()-a.Docks.fetched<12e4?(O.innerHTML=a.Docks.parseTime,e(),void 0):(promise.get("/api/latest").then(function(b,c){b||(a.Docks=r(c),a.Docks.fetched=Date.now(),O.innerHTML=a.Docks.parseTime,e())}),void 0)}function k(b){b.preventDefault(),b.stopPropagation();for(var c=b.target;c;){if("icon-cycle"===c.className){a.location.reload();break}if("timer"===c.id){Q.classList.toggle("active");var d={};d.timerlabel=gb.is_running()?"Stop timer":"Start timer",d.history=[];var e;try{e=r(localStorage.timerList)}catch(b){e=[]}for(var f=e.length;f--;)e[f].stop.time>0&&e[f].stop.time<e[f].start.time+55||d.history.push({start:{time:"<strong>Start:</strong> "+moment(1e3*e[f].start.time).format("MMMM Do, h:mm:ss a"),la:e[f].start.la,lo:e[f].start.lo},stop:{time:0===e[f].stop.time?"In progress":"<strong>Finish:</strong> "+moment(1e3*e[f].stop.time).format("MMMM Do, h:mm:ss a"),la:e[f].stop.la,lo:e[f].stop.lo},duration:0===e[f].stop.time?~~((Math.ceil(Date.now()/1e3)-e[f].start.time)/60<<0)+'"':~~((e[f].stop.time-e[f].start.time)/60<<0)+'"',"class":0===e[f].stop.time?"active":""});d.facebook=H?"":"notconnected",Q.innerHTML=X.timerlist(d);break}c=c.parentNode}}function l(a){a.preventDefault(),a.stopPropagation();for(var b=a.target;b;){if("LI"===b.tagName){if("active"===b.className)break;Q.classList.toggle("active"),v.setCenter(new google.maps.LatLng(b.dataset.timerStartLa,b.dataset.timerStartLo)),J.style.display="block",y=!0;break}b=b.parentNode}}function m(a){a.preventDefault(),a.stopPropagation();var b;b=void 0===localStorage.bookmarkDock?[]:r(localStorage.bookmarkDock);for(var c=b.length;c--;){var d=Docks.stations.filter(function(a){return a.id===b[c].id?!0:!1})[0];b[c].ab=d.ab,b[c].ad=d.ad,b[c].distance=g(F,G,b[c].la,b[c].lo)}L.innerHTML=X.bookmarks(b),K.classList.toggle("active")}function n(a){a.preventDefault(),a.stopPropagation();for(var b=a.target;b;){if("LI"===b.tagName){K.classList.toggle("active"),v.panTo(new google.maps.LatLng(b.dataset.dockla,b.dataset.docklo)),J.style.display="block",y=!0;break}if("icon-trashcan"===b.className){var c;c=r(localStorage.bookmarkDock),c=c.filter(function(a){return a.id===b.parentNode.dataset.dockid?!1:!0}),localStorage.bookmarkDock=JSON.stringify(c),b.parentNode.style.display="none";break}if("bookmarkscontent"===b.id)break;b=b.parentNode}}function o(c){c.preventDefault(),c.stopPropagation();var d=c.target;if("INPUT"===d.tagName)return d.focus(),d.classList.toggle("active"),new google.maps.places.Autocomplete(d),void 0;for(a.scrollTo(0,1);d;){if("SPAN"===d.tagName){b.getElementById("targetinput").blur(),R.classList.toggle("active");break}d=d.parentNode}}function p(a){a.preventDefault(),a.stopPropagation();var b=a.target;for(console.log(a);b;){if("icon-trashcan"===b.className){var c;c=r(localStorage.bookmarkDock),c=c.filter(function(a){return a.id===b.parentNode.dataset.dockid?!1:!0}),localStorage.bookmarkDock=JSON.stringify(c),b.parentNode.style.display="none";break}b=b.parentNode}}function q(){switch(a.orientation){case-90:case 90:N.style.display="block";break;default:N.style.display="none"}a.scrollTo(0,1)}function r(a){try{return JSON.parse(a)}catch(b){return[]}}function s(a){a.authResponse||"connected"===a.status?(H=!0,T.className="loggedin",M.querySelector("button .facebook")&&M.querySelector("button .facebook").classList.toggle("notconnected"),FB.api("/me?fields=id,first_name,name,picture",function(a){U.innerHTML=hb(a),FB.api({method:"fql.query",query:"SELECT uid, name, pic_square FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me() ) AND is_app_user = 1"},function(b){U.innerHTML=hb({user:a,friends:b}),T.querySelector("img").src=a.picture.data.url})})):U.innerHTML=hb({})}function t(a){for(var b,c=r(localStorage.timerList),d=c.length;d--;)if(c[d].share.facebook.uuid===a.uuid){b=d;break}if(b){var e="http://"+a.shareurl+"/bike/ride/"+c[b].uuid+"/start/"+c[b].start.dock.id+"/"+c[b].start.dock.la+"/"+c[b].start.dock.lo;promise.get(e).then(function(d){if(!d){var e=Math.ceil(Date.now()/1e3),f="http://"+a.shareurl+"/bike/ride/"+c[b].uuid;FB.api("/me/fitness.bikes","post",{course:f,start_time:e,expires_in:2700},function(a){if(a)if(a.error);else{var d='<a href="https://www.facebook.com/me/activity/'+a.id+'">'+"Story created.  ID is "+a.id+"</a>";console.log(d),c[b].share.facebook.responseid=a.id,localStorage.timerList=JSON.stringify(c)}else;})}})}}function u(a){if("share"in a&&"facebook"in a.share){var b="http://"+a.shareurl+"/bike/ride/"+a.share.facebook.uuid+"/stop/"+a.stop.dock.id+"/"+a.stop.dock.la+"/"+a.stop.dock.lo;promise.get(b).then(function(b){if(!b){var c=Math.ceil(Date.now()/1e3),d="http://"+a.shareurl+"/bike/ride/"+a.share.facebook.uuid;FB.api(a.share.facebook.responseid,"post",{course:d,end_time:c},function(b){b&&(b.error||FB.api(a.share.facebook.responseid,"get",{},function(a){a&&(a.error||FB.api(a.data.course.id,"post",{scrape:"true"},function(a){a&&a.error}))}))})}})}}var v,w,x,y,z,A,B,C=400,D=[],E=[],F=c.lang.mobile_js_global_lat,G=c.lang.mobile_js_global_lng,H=!1,I=b.getElementById("mapbikes"),J=b.getElementById("resetlocation"),K=b.getElementById("bookmarks"),L=b.getElementById("bookmarkscontent"),M=b.getElementById("dock"),N=b.getElementById("landscape"),O=b.getElementById("parseTime"),P=b.getElementById("timer"),Q=b.getElementById("timerlist"),R=b.getElementById("search"),S=b.getElementById("searchcontent"),T=b.getElementById("menu"),U=b.getElementById("menulist"),V=70,W=50,X={dock:doT.template(b.getElementById("docktmpl").text),timerlist:doT.template(b.getElementById("timerlisttmpl").text),bookmarks:doT.template(b.getElementById("bookmarkstmpl").text)},Y=a.navigator.msPointerEnabled?"MSPointerDown":"ontouchstart"in a?"touchstart":"mousedown",Z=function(){var c=b.createElement("canvas").getContext("2d"),d=a.devicePixelRatio||1,e=c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1;return d/e}(),$=function(){var a=navigator.userAgent;if(a.indexOf("Android")>=0){var b=parseFloat(a.slice(a.indexOf("Android")+8));if(3.2>b)return!0}return!1}(),_=a.navigator.msPointerEnabled?"Arial":navigator.userAgent.indexOf("Android")>=0?"Roboto":"STHeitiSC-Light",ab=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"===a?b:8|3&b;return c.toString(16)})},bb=new Image;bb.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAAyCAMAAADWQ11hAAACOlBMVEX///+5w8yvusWrt8KfrbmWpbKSoa+Roa+Jmql8j6B9j6B3ipx1iJp0iJpwhJdvg5Zkg59sgZRnfZBofZFmfI9nfJBleo9le45edYlfdYpedIpcc4hacYdYb4VUbIJTa4JPaH9OZ34+aY5JYnpIYnpAW3MgVYIyT2kBPXEPMVAAJEX////jIzXPIDEIcMn4Jjr4L0IBacL/KT/lL0CDlaVqf5JRaoD+9fWVpLL/h5Xz9fb/8fKGo7uPn63/f41vos6MnKuLm6qKm6r/7/GHmKfufYfufIeGl6f87++Bk6N1lK5/kaH6bnzw8vT/7O9vkKz/anrr7vB2iZv66ev/5Odzh5n6YW9xhZfh5eneaHP43uBMir9ugpU5jNP43d9tgpU3i9TX3eLdYW36WWj/0NXqXWr/VWf10tb50NT6VmX10dTyw8c9grxle4/9v8XDy9PcW2hkeo7pVmTbWGVhd4w4frv3vcPpUF7aVGG8xc7/+frvtbroTFvvtLr/rrdWboTYTFkBftUBfNT/rLQBfdSfw9/8qrLXR1UPdMr5+vv5OkwNc8vtqbD8o6xNZn4PccVKZHv/oq5JY3qluMj4M0bVPUz/9PWqtsEBasTlMkL8nKUBa7OQt9hCXXX4Kj7znqbqnKQBZ7EBZrChrrrQMTc7V3A5VW/SLDz29/iXrcHRJzfpl5/QIzOTq78BUZDIHx8BS4sBR4UBRoHeDCGUq8DaAAwBN2abqbb7ipT/iJTjJjg2Um2ou8z7iJN0NEFBAAAAAXRSTlMAQObYZgAAAdtJREFUeF7k0LWO9DAYhWHfz7GT4UVmZmZmZmZmZmZm+PHeNhltpC3sFJPp9imsU73SZ0LIh6PA5unnouAmR2gSUcTMF8GIzLQ9pdKweAmDMuoIad2AUVN/u8h5HAw7sZMBGOd9RnLhBsskAm5gJ0H4ZhBik07giiLJ2vSyrIJZdDLawxFIbNo8YOyabRvM9FPW2NnCeuVUcG0umM3mnKf3aF+9zG8ru2GsmGJ8OhI8z9q418n47AMX1AMy8P8BPG3aOBJn6mkYKmk5ui0A3sAzA0iSBGBYmKGMlTW3/wL81cyL6IMlqJlRUaaaZVHQwxIgfkk3I+lmZtdSKDr6rHCaOxUc9WVIlMm+BSAjfAuKUhlctdrYEWWQTif+jACxpqpEkykEXI8BhXmq3WNhBqhYh6qmJx8CCf9erxR3K2OijAt+Ruaz3XnJORgMAyh86n4r/6da6n7/y9gCzIwraWJgC9ZgNaxTpCEGTUjfd8ZZwJPDJlDoy5gfU9JhKjrMEVeDOXPRYK6slnIl02H+J2dGFtZErBS6QLknVGqLA8D+3xSnqRF3bRMXZndRQsP6C+CMW4nZOd7VN08l8khfs/p4kSiEg0as+MhqO3fGIM0PgpOHPDNz0CjPB90ArfwoF/YDOsQAAAAASUVORK5CYII=";var cb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAAAk1BMVEUAAAAAAAAAAAAVFRUvLy8qKio0MTE1MjI1MzP+JSX/ISH/HR0AAAA2MTHRKSk3MzMuLi42MjIsLCwcHBw4MjI2MTEpKSnIKSs2MzMyLCz/HR3/JCT/JSX/ISH/Jib/HBz/Hh7/IyP3JyfqKCj/Hx//IiLpKCjlKCjkKCjuKCjyJyf0JyfzJyf/ICD5Jyf8Jyf9Jyf0C/cBAAAAGnRSTlMAAQYMKxhdSHPW9v4DWb9vIUcjEil3JcV3KdIG2UwAAADySURBVHhedZHXbsMwDEXlufdIWmp6juz//7oKtBOkDz6iCOhC4CSIEVtOWdelY8UGeWOYlV24WdNkbmFXpvFWc88PwgggCgPfy7WO6ilJldxRaXJC3cyTM0h1Hykd70rCOclN/bnyUimHljKqrR2kTL3KILHtD3KgbIfqh2/HxCoCUC37QBUEhUUcNwQuvuAQug4pswjab7mFKCtJ3YAU/5Dw87vJz9dzM+1QxiC067rHo9NHe4pBMOXlernh1YYptwLF+kFggVs7/NpP09RPfX/j2M7ePBfLMs/zIvjW/GdUI1tXNu6jOhjswRqOlnaw4j8VMScl24SBeQAAAABJRU5ErkJggg==",db="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAMAAAAMCGV4AAAAYFBMVEX///8XEAkVDAIVFhcVExEVDAIVCwAYEw4XEAkYEQkYEQoXEgwWJDIVMVEUN10TNVsTNFkNPXIKP3kIQX8EQYMLQHsEQYUGQoMMQHkMQHoOP3QOP3YPPnIIQoEEQocLQXxatOuJAAAAE3RSTlMAEREiIiIiMzMzMzNViJmqu93u8OdLsgAAAHtJREFUeF5lj9kSwjAIRelelWwF0lX9/78UWp3p1PN2uGEJGGXbd31bwpcafYjBY31o5RIbyVV76gZ+GTw4fVFgMjU4YQGNNz1g38A9nDzcoIsnjw/LR3rujJpbP79nEZmFtd/mZ1q3ZVsp23zbn2laJsq2/3rf9f7r/z5HXA0vHQNE+wAAAABJRU5ErkJggg==",eb=function(){function a(a,b){localStorage.position=JSON.stringify({lat:a.toString(),lng:b.toString()})}function b(){return localStorage.position?r(localStorage.position):!1}return{set:a,get:b}}(),fb=function(){function a(a){F=a.coords.latitude,G=a.coords.longitude,f=a.coords.accuracy,g=new google.maps.LatLng(F,G),w.setPosition(g),y||v.setCenter(g)}function b(){g=new google.maps.LatLng(F,G),v.setCenter(g),w.setPosition(g),J.style.display="none",y=!1}function c(){}function d(){if(navigator.geolocation){var b={enableHighAccuracy:!0};e=navigator.geolocation.watchPosition(a,c,b)}else alert("Sorry, browser does not support geolocation!")}var e,f,g;return{getLocationUpdate:d,restoreLocation:b}}(),gb={options:{time:0,station:{},$time:P.querySelector("strong"),$stopwatch:P.querySelector(".icon-stopwatch"),$timelandscape:b.getElementById("timing")},start:function(a){if(B)return gb.stop({dock:{id:"false"}}),void 0;gb.options.time=localStorage.timer&&localStorage.timer.length>0?localStorage.timer:localStorage.timer=+Date.now(),gb.options.$stopwatch.style.display="none";var b=gb.difftostring(+Date.now()-gb.options.time);if(gb.options.$time.innerHTML=b,gb.options.$timelandscape.innerHTML=b,B=setInterval(gb.insert,1e3),void 0!==v){void 0===localStorage.timerList&&(localStorage.timerList=JSON.stringify([]));for(var c=r(localStorage.timerList),d=!1,e=c.length;e--;)0===c[e].stop.time&&(d=!0);if(!d){var f=Math.ceil(Date.now()/1e3),g=v.getCenter().lat(),h=v.getCenter().lng(),i=ab(),j={uuid:i,start:{time:f,la:g,lo:h,dock:{id:a.dock.id?a.dock.id:!1,sn:a.dock.id?a.dock.sn:!1,la:a.dock.id?a.dock.la:!1,lo:a.dock.id?a.dock.lo:!1}},stop:{time:0,la:"",lo:"",dock:{id:"",sn:"",la:"",lo:""}},share:{facebook:{uuid:a.fbshare?i:!1,responseid:""}}};c.push(j),localStorage.timerList=JSON.stringify(c),a.fbshare&&t({uuid:i})}}},stop:function(a){localStorage.timer="",clearInterval(B),B=0,gb.options.$time.innerHTML="",gb.options.$timelandscape.innerHTML="00 : 00",gb.options.$stopwatch.style.display="inline-block",void 0===localStorage.timerList&&(localStorage.timerList=JSON.stringify([]));for(var b=r(localStorage.timerList),c=Math.ceil(Date.now()/1e3),d=v.getCenter().lat(),e=v.getCenter().lng(),f=b.length;f--;)if(0===b[f].stop.time){b[f].stop={time:c,la:d,lo:e,dock:{id:a.dock.id?a.dock.id:!1,sn:a.dock.id?a.dock.sn:!1,la:a.dock.id?a.dock.la:d,lo:a.dock.id?a.dock.lo:e}},localStorage.timerList=JSON.stringify(b),u(b[f]);break}},insert:function(){var a=gb.difftostring(+Date.now()-gb.options.time);gb.options.$time.innerHTML=a,gb.options.$timelandscape.innerHTML=a},difftostring:function(a){var b=~~(a/1e3/60<<0);if(b>"59")return"over";var c=~~(a/1e3%60<<0);return b=10>b?"0"+b.toString():b,c=10>c?"0"+c.toString():c,b+" : "+c},check:function(){localStorage.timer&&localStorage.timer.length>0&&gb.start()},is_running:function(){return B?!0:!1}};b.getElementById("targetinput").addEventListener("focus",function(){window.scrollTo(0,1)},!1),J.addEventListener(Y,function(a){a.preventDefault(),a.stopPropagation(),fb.restoreLocation(y)}),N.addEventListener(Y,function(a){a.preventDefault(),a.stopPropagation()}),R.addEventListener(Y,o),S.addEventListener(Y,p),P.addEventListener(Y,k),gb.check(),Q.addEventListener(Y,l),T.addEventListener(Y,function(a){a.preventDefault(),a.stopPropagation(),T.classList.toggle("active")}),K.addEventListener(Y,m),L.addEventListener(Y,n),M.addEventListener(Y,f,!1),setTimeout(function(){a.scrollTo(0,1)},500),a.onorientationchange=q,window.fbAsyncInit=function(){FB.init({appId:c.fbappid,channelUrl:"//"+c.shareurl+"/channel.html",status:!0,cookie:!0,xfbml:!1}),FB.getLoginStatus(s,!0),U.addEventListener(Y,function(a){a.preventDefault(),a.stopPropagation();for(var b=a.target;b;){if("facebook"===b.className){FB.login(s,{scope:"publish_actions"});break}if("facebook_logout"===b.className){var d=confirm(c.lang.mobile_js_logout);d===!0&&FB.logout(function(){H=!1,U.innerHTML=hb({})});break}b=b.parentNode}})};var hb=doT.template(document.getElementById("menulisttmpl").text),U=document.getElementById("menulist");return function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/all.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk"),{mapInit:d}}(window,document,bikeplusoptions);