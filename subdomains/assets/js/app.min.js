/*! BikePlusApp 2013-08-11 13:49 */
bikeplusoptions.tmpl=function(){function a(){var a={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},b=/&(?!#?w+;)|<|>|"|'|\//g;return function(){return this?this.replace(b,function(b){return a[b]||b}):this}}String.prototype.encodeHTML=a();var b={};return b.bookmarks=function(a){var b="<h2><?php echo lang('mobile_bookmarkstitle');?></h2>";if(a.length){b+="<ul>";var c=a;if(c)for(var d,e=-1,f=c.length-1;f>e;)d=c[e+=1],b+="<li ",e%2&&(b+='class="zebra"'),b+=' data-dockid="'+d.id+'" data-dockla="'+d.la+'" data-docklo="'+d.lo+'"><span class="icon-trashcan"></span><p><span class="icon-location"></span>'+d.sn+"</p><span class='available_bikes'><span class=\"icon-bicycle\"></span> "+d.ab+"</span><span class='available_docks'><span class=\"icon-unlock-stroke\"></span> "+d.ad+"</span><span class='distance'><?php echo lang('mobile_dockdistance');?> <strong>"+d.distance+"</strong> <?php echo lang('mobile_dockdistanceunit');?></span></li>";b+="</ul>"}else b+="<p><?php echo lang('mobile_bookmarksnone');?></p>";return b},b.dock=function(a){var b="<div data-dockid='"+a.id+'\' class="setbookmark"><strong></strong><span class="icon-bookmark ';return a.bookmarksAdded&&(b+="added"),b+="\"></span></div><div class='close'><span></span></div><div class='dock'><div class=\"dock_name\">"+a.sn+'</div><span class="icon-bicycle"></span> '+a.ab+'<span class="icon-unlock-stroke"></span> '+a.ad,a.distance&&(b+="<span class='distance'><?php echo lang('mobile_dockdistance');?> <strong>"+a.distance+"</strong> <?php echo lang('mobile_dockdistanceunit');?></span>"),b+="</div><button data-dockid='"+a.id+"' value='"+a.timer+"' class='timing ",a.timer&&(b+="active"),b+='\'><div class="countdown"><span class="icon-stopwatch"></span></div><strong>'+a.timerlabel+'</strong><!--<div class="sharetwitter disabled"><span class="icon-twitter"></span></div>--><div class="sharefacebook '+a.facebook+'"><span class="icon-facebook"></span></div></button>'},b.menulist=function(a){var b="<ul>";if(a.user){if(b+="<li><span class=\"facebook_logout\"><?php echo lang('mobile_logout');?></span><span>"+a.user.first_name+"</span><!--<strong>"+a.rides+"</strong> Rides  <strong>"+a.miles+"</strong> Miles--></li><li>",a.friends){var c=a.friends;if(c)for(var d,e=-1,f=c.length-1;f>e;)d=c[e+=1],b+="<span><img src='"+d.pic_square+"'></span> <!-- "+d.name+" -->"}b+="</li>"}else b+="<li><button class='facebook'><span class=\"icon-facebook\"></span> <?php echo lang('mobile_loginwithfacebook');?></button></li>";return b+="<li><?php echo lang('mobile_logintemporarytext');?></li></ul>"},b.timerlist=function(a){var b="";if(a.history){b+="<h2><?php echo lang('mobile_historytitle');?></span></h2><ul>";var c=a.history;if(c)for(var d,e=-1,f=c.length-1;f>e;)d=c[e+=1],b+='<li class="'+d.class+'" data-timer-start-la="'+d.start.la+'" data-timer-start-lo="'+d.start.lo+'"  data-timer-stop-la="'+d.stop.la+'" data-timer-stop-lo="'+d.stop.lo+'"><span class="duration">'+d.duration+'</span><span class="icon-stopwatch"></span><span class="start">'+d.start.time+'</span><span class="stop">'+d.stop.time+"</span></li>";b+="</ul>"}return b},b}();var BikePlus=function(a,b){function c(){google.maps.visualRefresh=!0,H.style.height=a.innerHeight+70+"px",u=new google.maps.Map(H,{center:db.get()?new google.maps.LatLng(db.get().lat,db.get().lng):new google.maps.LatLng("40.7266119","-73.9930061"),zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0}),google.maps.event.trigger(u,"resize"),v=new google.maps.Marker({map:u,icon:{url:ab},zIndex:100}),google.maps.event.addListener(u,"dragstart",function(){I.style.top=a.innerHeight-60+"px",I.style.display="block",x=!0,a.scrollTo(0,1)}),google.maps.event.addListener(u,"bounds_changed",function(){"undefined"!=typeof y&&Date.now()-y<100||(y=+Date.now(),i(),v.setZIndex(google.maps.Marker.MAX_ZINDEX+1),db.set(u.getCenter().lat(),u.getCenter().lng()))}),setTimeout(function(){B=a.innerHeight,H.style.height=B+70+"px",J.style.top=B-60+"px",I.style.top=B-60+"px",L.style.top=B+60+"px"},750),eb.getLocationUpdate()}function d(){for(var a=u.getZoom(),b=u.getBounds(),c=0,d=bikeplusoptions.data.stations.length;d>c;c++){var e=new google.maps.LatLng(bikeplusoptions.data.stations[c].la,bikeplusoptions.data.stations[c].lo);b.contains(e)&&D.push({id:bikeplusoptions.data.stations[c].id,ad:bikeplusoptions.data.stations[c].ad,ab:bikeplusoptions.data.stations[c].ab,sn:bikeplusoptions.data.stations[c].sn,la:bikeplusoptions.data.stations[c].la,lo:bikeplusoptions.data.stations[c].lo,latLng:e})}for(var c=0,d=D.length;d>c;c++)if(id=D[c].id,C[id]=C[id]||{},16>a){var g=15+2*(a-16);void 0===C[id].marker?C[id].marker=new google.maps.Marker({position:D[c].latLng,map:u,icon:{url:bb,size:new google.maps.Size(g,g),scaledSize:new google.maps.Size(g,g)},zIndex:1,optimized:!0}):C[id].markerType!=="small"+g&&C[id].marker.setIcon({url:bb,size:new google.maps.Size(g,g),scaledSize:new google.maps.Size(g,g)}),C[id].markerType="small"+g,void 0!==C[id].listenerHandler&&(google.maps.event.removeListener(C[id].listenerHandler),C[id].listenerHandler=void 0)}else void 0===C[id].marker?C[id].marker=new google.maps.Marker({position:D[c].latLng,map:u,icon:{url:Y?cb:h(D[c].id,D[c].sn,D[c].ab,D[c].ad),size:new google.maps.Size(U,V),scaledSize:new google.maps.Size(U,V)},zIndex:1}):"big"!==C[id].markerType&&C[id].marker.setIcon({url:Y?cb:h(D[c].id,D[c].sn,D[c].ab,D[c].ad),size:new google.maps.Size(U,V),scaledSize:new google.maps.Size(U,V)}),C[id].markerType="big",void 0===C[id].listenerHandler&&(C[id].listenerHandler=google.maps.event.addListener(C[id].marker,"click",function(a){return function(){return a===w?(H.style.height=B+20+"px",google.maps.event.trigger(u,"resize"),u.panTo(z),I.style.display="block",x=!0,L.style.top=B+60+"px",w="",void 0):(w=a,fb.is_running()?(D[a].timer="true",D[a].timerlabel=bikeplusoptions.lang.mobile_js_ride_finish):(D[a].timer="",D[a].timerlabel=bikeplusoptions.lang.mobile_js_ride_start),D[a].facebook=G?"":"notconnected",currentBookmarks=void 0===localStorage.bookmarkDock?[]:q(localStorage.bookmarkDock),D[a].bookmarksAdded=currentBookmarks.filter(function(b){return b.id===D[a].id?!0:!1})[0],z=u.getCenter(),D[a].distance=f(E,F,D[a].la,D[a].lo),L.innerHTML=bikeplusoptions.tmpl.dock(D[a]),L.style.top=B-100-48+"px",H.style.height=B-100-48+20+"px",google.maps.event.trigger(u,"resize"),u.panTo(D[a].latLng),x=!0,void 0)}}(c)))}function e(a){a.preventDefault(),a.stopPropagation();for(var b=a.target;b;){if("close"===b.className){H.style.height=B+20+"px",google.maps.event.trigger(u,"resize"),u.panTo(z),I.style.display="block",x=!0,L.style.top=B+60+"px";break}if(b.className.indexOf("timing")>-1){var c=bikeplusoptions.data.stations.filter(function(a){return a.id===b.dataset.dockid?!0:!1})[0];if("true"===b.value){fb.stop({dock:{id:c.id,sn:c.sn,la:c.la,lo:c.lo}}),b.className="timing",b.querySelector("strong").innerHTML=bikeplusoptions.lang.mobile_js_ride_start,b.value="";break}var d=b.querySelector(".sharefacebook").className.indexOf("facebook")>-1?!0:!1,e=b.querySelector(".countdown"),f=b.querySelector("strong");f.innerHTML=bikeplusoptions.lang.mobile_js_ride_starting,setTimeout(function(){e.innerHTML="<span>3</span>"},50),setTimeout(function(){e.innerHTML="<span>2</span>"},1250),setTimeout(function(){e.innerHTML="<span>1</span>",fb.start({fbshare:d,dock:{id:c.id,sn:c.sn,la:c.la,lo:c.lo}})},2500),setTimeout(function(){b.value="true",b.className="timing active",e.innerHTML='<span class="icon-stopwatch"></span>',f.innerHTML=bikeplusoptions.lang.mobile_js_ride_finish},3750),setTimeout(function(){H.style.height=B+20+"px",google.maps.event.trigger(u,"resize"),u.panTo(z),I.style.display="block",x=!0,L.style.top=B+60+"px"},5e3);break}if(b.className.indexOf("sharefacebook")>-1){b.className.indexOf("notconnected")>-1?FB.login(r,{scope:"publish_actions"}):b.classList.toggle("disabled");break}if(b.className.indexOf("setbookmark")>-1){g(b);break}b=b.parentNode}}function f(a,b,c,d){c=Number(c),d=Number(d),a=parseInt(1e8*a,10)/1e8,b=parseInt(1e8*b,10)/1e8,c=parseInt(1e8*c,10)/1e8,d=parseInt(1e8*d,10)/1e8;var e=bikeplusoptions.lang.mobile_dockdistanceratio,f=Math.PI/180,g=(c-a)*f,h=(d-b)*f,i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(a*f)*Math.cos(c*f)*Math.sin(h/2)*Math.sin(h/2),j=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),k=e*j;return Math.round(100*k)/100}function g(a){var b=bikeplusoptions.data.stations.filter(function(b){return b.id===a.dataset.dockid?!0:!1})[0];void 0===localStorage.bookmarkDock&&(localStorage.bookmarkDock=JSON.stringify([]));var c=q(localStorage.bookmarkDock);0===c.filter(function(b){return b.id===a.dataset.dockid?!0:!1}).length&&c.push({id:b.id,sn:b.sn,la:b.la,lo:b.lo,latLng:b.latLng}),localStorage.bookmarkDock=JSON.stringify(c),a.querySelector("strong").innerHTML=bikeplusoptions.lang.mobile_js_bookmarks_added,a.querySelector(".icon-bookmark").classList.add("added"),setTimeout(function(){a.querySelector("strong").innerHTML=""},1750)}function h(a,c,d,e){var f=c+d+e;if(h.cache||(h.cache={}),h.cache[f])return h.cache[f];var g=b.createElement("canvas");return context=g.getContext("2d"),g.width=U*X,g.height=V*X,context.drawImage(_,0,0,g.width,g.height),context.fillStyle="rgba(255,255,255,1)",context.font=10*X+"px "+Z,context.textAlign="left",context.fillText(c,5*X,37*X,60*X),context.fillStyle="rgba(0,0,0,1)",context.font=16*X+"px "+Z,context.textAlign="left",context.fillText(d,20*X,20*X),context.fillText(e,51*X,20*X),h.cache[f]=g.toDataURL(),h.cache[f]}function i(){return"undefined"!=typeof a.bikeplusoptions.data&&Date.now()-a.bikeplusoptions.data.fetched<12e4?(N.innerHTML=a.bikeplusoptions.data.parseTime,d(),void 0):(promise.get("/api/latest").then(function(b,c){b||(a.bikeplusoptions.data=q(c),a.bikeplusoptions.data.fetched=Date.now(),N.innerHTML=a.bikeplusoptions.data.parseTime,d())}),void 0)}function j(b){b.preventDefault(),b.stopPropagation();for(var c=b.target;c;){if("icon-cycle"===c.className){a.location.reload();break}if("timer"===c.id){P.classList.toggle("active");var d={};d.timerlabel=fb.is_running()?"Stop timer":"Start timer",d.history=[];for(var e=q(localStorage.timerList),f=e.length;f--;)e[f].stop.time>0&&e[f].stop.time<e[f].start.time+55||d.history.push({start:{time:"<strong>Start:</strong> "+moment(1e3*e[f].start.time).format("MMMM Do, h:mm:ss a"),la:e[f].start.la,lo:e[f].start.lo},stop:{time:0===e[f].stop.time?"In progress":"<strong>Finish:</strong> "+moment(1e3*e[f].stop.time).format("MMMM Do, h:mm:ss a"),la:e[f].stop.la,lo:e[f].stop.lo},duration:0===e[f].stop.time?~~((Math.ceil(Date.now()/1e3)-e[f].start.time)/60<<0)+'"':~~((e[f].stop.time-e[f].start.time)/60<<0)+'"',"class":0===e[f].stop.time?"active":""});d.facebook=G?"":"notconnected",P.innerHTML=bikeplusoptions.tmpl.timerlist(d);break}c=c.parentNode}}function k(a){a.preventDefault(),a.stopPropagation();for(var b=a.target;b;){if("LI"===b.tagName){if("active"===b.className)break;P.classList.toggle("active"),u.setCenter(new google.maps.LatLng(b.dataset.timerStartLa,b.dataset.timerStartLo)),I.style.display="block",x=!0;break}b=b.parentNode}}function l(a){a.preventDefault(),a.stopPropagation();var b;b=void 0===localStorage.bookmarkDock?[]:q(localStorage.bookmarkDock);for(var c=b.length;c--;){var d=bikeplusoptions.data.stations.filter(function(a){return a.id===b[c].id?!0:!1})[0];b[c].ab=d.ab,b[c].ad=d.ad,b[c].distance=f(E,F,b[c].la,b[c].lo)}K.innerHTML=bikeplusoptions.tmpl.bookmarks(b),J.classList.toggle("active")}function m(a){a.preventDefault(),a.stopPropagation();for(var b=a.target;b;){if("LI"===b.tagName){J.classList.toggle("active"),u.panTo(new google.maps.LatLng(b.dataset.dockla,b.dataset.docklo)),I.style.display="block",x=!0;break}if("icon-trashcan"===b.className){var c;c=q(localStorage.bookmarkDock),c=c.filter(function(a){return a.id===b.parentNode.dataset.dockid?!1:!0}),localStorage.bookmarkDock=JSON.stringify(c),b.parentNode.style.display="none";break}if("bookmarkscontent"===b.id)break;b=b.parentNode}}function n(c){c.preventDefault(),c.stopPropagation();var d=c.target;if("INPUT"===d.tagName)return d.focus(),d.classList.toggle("active"),new google.maps.places.Autocomplete(d),void 0;for(a.scrollTo(0,1);d;){if("SPAN"===d.tagName){b.getElementById("targetinput").blur(),Q.classList.toggle("active");break}d=d.parentNode}}function o(a){a.preventDefault(),a.stopPropagation();for(var b=a.target;b;){if("icon-trashcan"===b.className){var c;c=q(localStorage.bookmarkDock),c=c.filter(function(a){return a.id===b.parentNode.dataset.dockid?!1:!0}),localStorage.bookmarkDock=JSON.stringify(c),b.parentNode.style.display="none";break}b=b.parentNode}}function p(){switch(a.orientation){case-90:case 90:M.style.display="block";break;default:M.style.display="none"}a.scrollTo(0,1)}function q(a){try{return JSON.parse(a)}catch(b){return[]}}function r(a){a.authResponse||"connected"===a.status?(G=!0,S.className="loggedin",L.querySelector(".facebook")&&L.querySelector(".facebook").classList.toggle("notconnected"),FB.api("/me?fields=id,first_name,name,picture",function(a){T.innerHTML=bikeplusoptions.tmpl.menulist(a),FB.api({method:"fql.query",query:"SELECT uid, name, pic_square FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me() ) AND is_app_user = 1"},function(b){T.innerHTML=bikeplusoptions.tmpl.menulist({user:a,friends:b}),S.querySelector("img").src=a.picture.data.url})})):T.innerHTML=bikeplusoptions.tmpl.menulist({})}function s(a){for(var b,c=q(localStorage.timerList),d=c.length;d--;)if(c[d].share.facebook.uuid===a.uuid){b=d;break}if(b){var e="http://"+bikeplusoptions.shareurl+"/bike/ride/"+c[b].uuid+"/start/"+c[b].start.dock.id+"/"+c[b].start.dock.la+"/"+c[b].start.dock.lo;promise.get(e).then(function(a){if(!a){var d=Math.ceil(Date.now()/1e3),e="http://"+bikeplusoptions.shareurl+"/bike/ride/"+c[b].uuid;FB.api("/me/fitness.bikes","post",{course:e,start_time:d,expires_in:2700},function(a){if(a)if(a.error);else{{'<a href="https://www.facebook.com/me/activity/'+a.id+'">'+"Story created.  ID is "+a.id+"</a>"}c[b].share.facebook.responseid=a.id,localStorage.timerList=JSON.stringify(c)}else;})}})}}function t(a){if("share"in a&&"facebook"in a.share){var b="http://"+bikeplusoptions.shareurl+"/bike/ride/"+a.share.facebook.uuid+"/stop/"+a.stop.dock.id+"/"+a.stop.dock.la+"/"+a.stop.dock.lo;promise.get(b).then(function(b){if(!b){var c=Math.ceil(Date.now()/1e3),d="http://"+bikeplusoptions.shareurl+"/bike/ride/"+a.share.facebook.uuid;FB.api(a.share.facebook.responseid,"post",{course:d,end_time:c},function(b){b&&(b.error||FB.api(a.share.facebook.responseid,"get",{},function(a){a&&(a.error||FB.api(a.data.course.id,"post",{scrape:"true"},function(a){a&&a.error}))}))})}})}}var u,v,w,x,y,z,A,B=400,C=[],D=[],E=bikeplusoptions.lang.mobile_js_global_lat,F=bikeplusoptions.lang.mobile_js_global_lng,G=!1,H=b.getElementById("mapbikes"),I=b.getElementById("resetlocation"),J=b.getElementById("bookmarks"),K=b.getElementById("bookmarkscontent"),L=b.getElementById("dock"),M=b.getElementById("landscape"),N=b.getElementById("parseTime"),O=b.getElementById("timer"),P=b.getElementById("timerlist"),Q=b.getElementById("search"),R=b.getElementById("searchcontent"),S=b.getElementById("menu"),T=b.getElementById("menulist"),U=70,V=50,W=a.navigator.msPointerEnabled?"MSPointerDown":"ontouchstart"in a?"touchstart":"mousedown",X=function(){var c=b.createElement("canvas").getContext("2d"),d=a.devicePixelRatio||1,e=c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1;return d/e}(),Y=function(){var a=navigator.userAgent;if(a.indexOf("Android")>=0){var b=parseFloat(a.slice(a.indexOf("Android")+8));if(3.2>b)return!0}return!1}(),Z=a.navigator.msPointerEnabled?"Arial":navigator.userAgent.indexOf("Android")>=0?"Roboto":"STHeitiSC-Light",$=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"===a?b:8|3&b;return c.toString(16)})},_=new Image;_.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAAyCAMAAADWQ11hAAACOlBMVEX///+5w8yvusWrt8KfrbmWpbKSoa+Roa+Jmql8j6B9j6B3ipx1iJp0iJpwhJdvg5Zkg59sgZRnfZBofZFmfI9nfJBleo9le45edYlfdYpedIpcc4hacYdYb4VUbIJTa4JPaH9OZ34+aY5JYnpIYnpAW3MgVYIyT2kBPXEPMVAAJEX////jIzXPIDEIcMn4Jjr4L0IBacL/KT/lL0CDlaVqf5JRaoD+9fWVpLL/h5Xz9fb/8fKGo7uPn63/f41vos6MnKuLm6qKm6r/7/GHmKfufYfufIeGl6f87++Bk6N1lK5/kaH6bnzw8vT/7O9vkKz/anrr7vB2iZv66ev/5Odzh5n6YW9xhZfh5eneaHP43uBMir9ugpU5jNP43d9tgpU3i9TX3eLdYW36WWj/0NXqXWr/VWf10tb50NT6VmX10dTyw8c9grxle4/9v8XDy9PcW2hkeo7pVmTbWGVhd4w4frv3vcPpUF7aVGG8xc7/+frvtbroTFvvtLr/rrdWboTYTFkBftUBfNT/rLQBfdSfw9/8qrLXR1UPdMr5+vv5OkwNc8vtqbD8o6xNZn4PccVKZHv/oq5JY3qluMj4M0bVPUz/9PWqtsEBasTlMkL8nKUBa7OQt9hCXXX4Kj7znqbqnKQBZ7EBZrChrrrQMTc7V3A5VW/SLDz29/iXrcHRJzfpl5/QIzOTq78BUZDIHx8BS4sBR4UBRoHeDCGUq8DaAAwBN2abqbb7ipT/iJTjJjg2Um2ou8z7iJN0NEFBAAAAAXRSTlMAQObYZgAAAdtJREFUeF7k0LWO9DAYhWHfz7GT4UVmZmZmZmZmZmZm+PHeNhltpC3sFJPp9imsU73SZ0LIh6PA5unnouAmR2gSUcTMF8GIzLQ9pdKweAmDMuoIad2AUVN/u8h5HAw7sZMBGOd9RnLhBsskAm5gJ0H4ZhBik07giiLJ2vSyrIJZdDLawxFIbNo8YOyabRvM9FPW2NnCeuVUcG0umM3mnKf3aF+9zG8ru2GsmGJ8OhI8z9q418n47AMX1AMy8P8BPG3aOBJn6mkYKmk5ui0A3sAzA0iSBGBYmKGMlTW3/wL81cyL6IMlqJlRUaaaZVHQwxIgfkk3I+lmZtdSKDr6rHCaOxUc9WVIlMm+BSAjfAuKUhlctdrYEWWQTif+jACxpqpEkykEXI8BhXmq3WNhBqhYh6qmJx8CCf9erxR3K2OijAt+Ruaz3XnJORgMAyh86n4r/6da6n7/y9gCzIwraWJgC9ZgNaxTpCEGTUjfd8ZZwJPDJlDoy5gfU9JhKjrMEVeDOXPRYK6slnIl02H+J2dGFtZErBS6QLknVGqLA8D+3xSnqRF3bRMXZndRQsP6C+CMW4nZOd7VN08l8khfs/p4kSiEg0as+MhqO3fGIM0PgpOHPDNz0CjPB90ArfwoF/YDOsQAAAAASUVORK5CYII=";var ab="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAAAk1BMVEUAAAAAAAAAAAAVFRUvLy8qKio0MTE1MjI1MzP+JSX/ISH/HR0AAAA2MTHRKSk3MzMuLi42MjIsLCwcHBw4MjI2MTEpKSnIKSs2MzMyLCz/HR3/JCT/JSX/ISH/Jib/HBz/Hh7/IyP3JyfqKCj/Hx//IiLpKCjlKCjkKCjuKCjyJyf0JyfzJyf/ICD5Jyf8Jyf9Jyf0C/cBAAAAGnRSTlMAAQYMKxhdSHPW9v4DWb9vIUcjEil3JcV3KdIG2UwAAADySURBVHhedZHXbsMwDEXlufdIWmp6juz//7oKtBOkDz6iCOhC4CSIEVtOWdelY8UGeWOYlV24WdNkbmFXpvFWc88PwgggCgPfy7WO6ilJldxRaXJC3cyTM0h1Hykd70rCOclN/bnyUimHljKqrR2kTL3KILHtD3KgbIfqh2/HxCoCUC37QBUEhUUcNwQuvuAQug4pswjab7mFKCtJ3YAU/5Dw87vJz9dzM+1QxiC067rHo9NHe4pBMOXlernh1YYptwLF+kFggVs7/NpP09RPfX/j2M7ePBfLMs/zIvjW/GdUI1tXNu6jOhjswRqOlnaw4j8VMScl24SBeQAAAABJRU5ErkJggg==",bb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAMAAAAMCGV4AAAAYFBMVEX///8XEAkVDAIVFhcVExEVDAIVCwAYEw4XEAkYEQkYEQoXEgwWJDIVMVEUN10TNVsTNFkNPXIKP3kIQX8EQYMLQHsEQYUGQoMMQHkMQHoOP3QOP3YPPnIIQoEEQocLQXxatOuJAAAAE3RSTlMAEREiIiIiMzMzMzNViJmqu93u8OdLsgAAAHtJREFUeF5lj9kSwjAIRelelWwF0lX9/78UWp3p1PN2uGEJGGXbd31bwpcafYjBY31o5RIbyVV76gZ+GTw4fVFgMjU4YQGNNz1g38A9nDzcoIsnjw/LR3rujJpbP79nEZmFtd/mZ1q3ZVsp23zbn2laJsq2/3rf9f7r/z5HXA0vHQNE+wAAAABJRU5ErkJggg==",cb="/assets/img/geolocationmarker_old_android.v2.png",db=function(){function a(a,b){localStorage.position=JSON.stringify({lat:a.toString(),lng:b.toString()})}function b(){return localStorage.position?q(localStorage.position):!1}return{set:a,get:b}}(),eb=function(){function a(a){E=a.coords.latitude,F=a.coords.longitude,f=a.coords.accuracy,g=new google.maps.LatLng(E,F),v.setPosition(g),x||u.setCenter(g)}function b(){g=new google.maps.LatLng(E,F),u.setCenter(g),v.setPosition(g),I.style.display="none",x=!1}function c(){}function d(){if(navigator.geolocation){var b={enableHighAccuracy:!0};e=navigator.geolocation.watchPosition(a,c,b)}else alert("Sorry, browser does not support geolocation!")}var e,f,g;return{getLocationUpdate:d,restoreLocation:b}}(),fb={options:{time:0,station:{},$time:O.querySelector("strong"),$stopwatch:O.querySelector(".icon-stopwatch"),$timelandscape:b.getElementById("timing")},start:function(a){if(A)return fb.stop({dock:{id:"false"}}),void 0;fb.options.time=localStorage.timer&&localStorage.timer.length>0?localStorage.timer:localStorage.timer=+Date.now(),fb.options.$stopwatch.style.display="none";var b=fb.difftostring(+Date.now()-fb.options.time);if(fb.options.$time.innerHTML=b,fb.options.$timelandscape.innerHTML=b,A=setInterval(fb.insert,1e3),void 0!==u){void 0===localStorage.timerList&&(localStorage.timerList=JSON.stringify([]));for(var c=q(localStorage.timerList),d=!1,e=c.length;e--;)0===c[e].stop.time&&(d=!0);if(!d){var f=Math.ceil(Date.now()/1e3),g=u.getCenter().lat(),h=u.getCenter().lng(),i=$(),j={uuid:i,start:{time:f,la:g,lo:h,dock:{id:a.dock.id?a.dock.id:!1,sn:a.dock.id?a.dock.sn:!1,la:a.dock.id?a.dock.la:!1,lo:a.dock.id?a.dock.lo:!1}},stop:{time:0,la:"",lo:"",dock:{id:"",sn:"",la:"",lo:""}},share:{facebook:{uuid:a.fbshare?i:!1,responseid:""}}};c.push(j),localStorage.timerList=JSON.stringify(c),a.fbshare&&s({uuid:i})}}},stop:function(a){localStorage.timer="",clearInterval(A),A=0,fb.options.$time.innerHTML="",fb.options.$timelandscape.innerHTML="00 : 00",fb.options.$stopwatch.style.display="inline-block",void 0===localStorage.timerList&&(localStorage.timerList=JSON.stringify([]));for(var b=q(localStorage.timerList),c=Math.ceil(Date.now()/1e3),d=u.getCenter().lat(),e=u.getCenter().lng(),f=b.length;f--;)if(0===b[f].stop.time){b[f].stop={time:c,la:d,lo:e,dock:{id:a.dock.id?a.dock.id:!1,sn:a.dock.id?a.dock.sn:!1,la:a.dock.id?a.dock.la:d,lo:a.dock.id?a.dock.lo:e}},localStorage.timerList=JSON.stringify(b),t(b[f]);break}},insert:function(){var a=fb.difftostring(+Date.now()-fb.options.time);fb.options.$time.innerHTML=a,fb.options.$timelandscape.innerHTML=a},difftostring:function(a){var b=~~(a/1e3/60<<0);if(b>"59")return"over";var c=~~(a/1e3%60<<0);return b=10>b?"0"+b.toString():b,c=10>c?"0"+c.toString():c,b+" : "+c},check:function(){localStorage.timer&&localStorage.timer.length>0&&fb.start()},is_running:function(){return A?!0:!1}};return b.getElementById("targetinput").addEventListener("focus",function(){window.scrollTo(0,1)},!1),I.addEventListener(W,function(a){a.preventDefault(),a.stopPropagation(),eb.restoreLocation(x)}),M.addEventListener(W,function(a){a.preventDefault(),a.stopPropagation()}),Q.addEventListener(W,n),R.addEventListener(W,o),O.addEventListener(W,j),fb.check(),P.addEventListener(W,k),S.addEventListener(W,function(a){a.preventDefault(),a.stopPropagation(),S.classList.toggle("active")}),J.addEventListener(W,l),K.addEventListener(W,m),L.addEventListener(W,e,!1),setTimeout(function(){a.scrollTo(0,1)},500),a.onorientationchange=p,window.fbAsyncInit=function(){FB.init({appId:bikeplusoptions.fbappid,channelUrl:"//"+bikeplusoptions.shareurl+"/channel.html",status:!0,cookie:!0,xfbml:!1}),FB.getLoginStatus(r,!0),T.addEventListener(W,function(a){a.preventDefault(),a.stopPropagation();for(var b=a.target;b;){if("facebook"===b.className){FB.login(r,{scope:"publish_actions"});break}if("facebook_logout"===b.className){var c=confirm(bikeplusoptions.lang.mobile_js_logout);c===!0&&FB.logout(function(){G=!1,T.innerHTML=bikeplusoptions.tmpl.menulist({})});break}b=b.parentNode}})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/all.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk"),{mapInit:c}}(window,document);